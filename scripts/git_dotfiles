#!/bin/bash

# colors
RED='\x1b[38;2;232;36;36m'     # #E82424
YELLOW='\x1b[38;2;255;158;59m' # #FF9E3B
GREEN='\x1b[38;2;106;149;137m' # #6A9589
BLUE='\x1b[38;2;101;133;148m'  # #658594

# list of configs and scripts to copy
configs=("bat" "browser" "btop" "clang-format" "eza" "fastfetch" "git" "i3" "kitty" "lazygit" "ncdu" "npm" "nvim" "rofi" "stylua.toml" "tmux" "wallpapers" "wget" "yazi" "zathura" "zsh" "fzf.conf" "ripgrep.conf" "shellcheckrc")
scripts=("assemble" "codelldb_stdio_redirection" "compile_sfml" "fzf_preview_wrapper" "git_dotfiles" "remove_codelldb_stdio_redirection")

# clone the repo if it is not in ~/.config ans cd into it
[[ -d ~/.config/dotfiles ]] || git clone https://github.com/anonymousgrasshopper/dotfiles ~/.config/dotfiles
cd ~/.config/dotfiles || {
  echo "${RED}Cloning the GitHub repository failed. Check you internet connection and try again"
  exit
}

# overwrite configs in the dotfiles repo
for config in ${configs[@]}; do
  if [[ -d "configs/$config" || -f "configs/$config" ]]; then
    rm -rf "configs/$config"
  fi
  if [[ -e "$HOME/.config/$config" ]]; then
    cp -r "$HOME/.config/$config" "configs"
  else
    echo "${YELLOW} ~/.config/$config not found."
  fi
done
# overwrite scripts in the dotfiles repo
for script in ${scripts[@]}; do
  if [[ -f "scripts/$script" ]]; then
    rm -rf "scripts/$script"
  fi
  if [[ -f "/usr/local/bin/$script" ]]; then
    cp "/usr/local/bin/$script" "scripts"
  else
    echo "${YELLOW} /usr/local/bin/$script not found."
  fi
done

# remove chosen files and directories
[[ -f "configs/zsh/.zcompdump" ]] && rm "configs/zsh/.zcompdump"
[[ -d "configs/browser/profile" ]] && rm -rf "configs/browser/profile"

# add everything to the index
git add .

# commit if args are passed to the scripts
if [[ $# == 2 ]]; then
  echo -e "${GREEN}"
  git commit -m"$1" -m"$2"
  echo -e "${BLUE}"
  git push
elif [[ $# == 1 ]]; then
  echo -e "${GREEN}"
  git commit -m"$1"
  echo -e "${BLUE}"
  git push
fi
